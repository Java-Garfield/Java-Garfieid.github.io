*.class

# Mobile Tools for Java (J2ME)
.mtj.tmp/

# Package Files #
*.jar
*.war
*.ear

# virtual machine crash logs, see http://www.java.com/en/download/help/error_hotspot.xml
hs_err_pid*
package com.wonderfc.service;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;

import com.wonderfc.dao.SqlHelper;
import com.wonderfc.domain.User;

public class UsersService {
	//写一个验证用户是否合法的函数
	
	public boolean checkUser(User user) {
		//连接数据库，
		boolean b=false;
		//使用SQLHELPER来完成查询任务
		String sql="select * from users where id=? and passwd=?";
		String parameters[]={user.getId()+"",user.getPasswd()};
		ResultSet rs=SqlHelper.executeQuery(sql, parameters);
		//根据rs来判断该用户是否存在	
		try {
			if (rs.next()) {
				b=true;
				}
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}finally{
			SqlHelper.close(SqlHelper.getCt(), SqlHelper.getPs(), SqlHelper.getRs());
		}
		return b;
	}	
	//按照分页来获取用户
	//公司把ResultSet->User对象->ArrayList(集合)
	public ArrayList getUsersByPage(int pageNow,int pageSize){
		ArrayList<User> al=new ArrayList<User>();
		//查询sql
		String sql="select t2.* from (select t1.*,rownum rn from (select * from users order by id)t1 where rownum<="+pageSize*pageNow+")t2 where rn>="+(pageSize*(pageNow-1)+1);
		ResultSet rs=SqlHelper.executeQuery(sql, null);
		//二次封装把ResultSet->User对象->ArrayList(集合)
		try {
			while (rs.next()) {
				User user=new User();
				user.setId(rs.getInt(1));
				user.setUsername(rs.getString(2));
				user.setEmail(rs.getString(3));
				user.setGrade(rs.getInt(4));
				//uer.setPasswd(rs.getString(5));
				//千万不要忘记u->arraylist
				al.add(user);
			}
		} catch (SQLException e) {
			e.printStackTrace();
		}finally{
			SqlHelper.close(SqlHelper.getCt(), SqlHelper.getPs(),SqlHelper.getRs());
		}
		return al;
	}
	//获取pageCount
	public int getPageCount(int pageSize){
		String sql="select count(*) from users";
		int rowCount=0;
		ResultSet rs=SqlHelper.executeQuery(sql, null);
		try {
			rs.next();
			rowCount=rs.getInt(1);
		} catch (SQLException e) {
			e.printStackTrace();
		}finally{
			SqlHelper.close(SqlHelper.getCt(), SqlHelper.getPs(),SqlHelper.getRs());
		}
		
		return (rowCount-1)/pageSize+1;
	}
	//删除用户
	public boolean delUser(String id){
		boolean b=true;
		String sql="delete from users where id=?";
		String parameters[]={id};
		try {			
			SqlHelper.executeUpdate(sql, parameters);
		} catch (Exception e) {
			b=false;
		}
		return b;
	}
}
